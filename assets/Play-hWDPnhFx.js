var t=Object.defineProperty,e=(e,s,n)=>((e,s,n)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n)(e,"symbol"!=typeof s?s+"":s,n);import{r as s,j as n}from"./react-three-BdgxNMf0.js";import{L as i}from"./vendor-DgkQOziQ.js";function r(t,e,s,n){var i=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(i,r.prototype),i.expected=e,i.found=s,i.location=n,i.name="SyntaxError",i}function o(t,e,s){return s=s||" ",t.length>e?t:(e-=t.length,t+(s+=s.repeat(e)).slice(0,e))}function a(t,e){var s,n,i,o,a={},l=(e=void 0!==e?e:{}).grammarSource,h={pgn:Vt},c=Vt,u="[",f='"',d="]",p=".",m="O-O-O",g="O-O",_="0-0-0",v="0-0",b="$",k="{",y="}",w=";",C="(",S=")",E="1-0",x="0-1",N="1/2-1/2",A="*",M=/^[a-zA-Z]/,j=/^[^"]/,P=/^[0-9]/,I=/^[.]/,T=/^[a-zA-Z1-8\-=]/,O=/^[+#]/,L=/^[!?]/,q=/^[^}]/,K=/^[^\r\n]/,R=/^[ \t\r\n]/,B=$t("tag pair"),F=Dt("[",!1),D=Dt('"',!1),U=Dt("]",!1),$=$t("tag name"),z=Ut([["a","z"],["A","Z"]],!1,!1),H=$t("tag value"),Q=Ut(['"'],!0,!1),V=$t("move number"),W=Ut([["0","9"]],!1,!1),G=Dt(".",!1),Y=Ut(["."],!1,!1),Z=$t("standard algebraic notation"),J=Dt("O-O-O",!1),X=Dt("O-O",!1),tt=Dt("0-0-0",!1),et=Dt("0-0",!1),st=Ut([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),nt=Ut(["+","#"],!1,!1),it=$t("suffix annotation"),rt=Ut(["!","?"],!1,!1),ot=$t("NAG"),at=Dt("$",!1),lt=$t("brace comment"),ht=Dt("{",!1),ct=Ut(["}"],!0,!1),ut=Dt("}",!1),ft=$t("rest of line comment"),dt=Dt(";",!1),pt=Ut(["\r","\n"],!0,!1),mt=$t("variation"),gt=Dt("(",!1),_t=Dt(")",!1),vt=$t("game termination marker"),bt=Dt("1-0",!1),kt=Dt("0-1",!1),yt=Dt("1/2-1/2",!1),wt=Dt("*",!1),Ct=$t("whitespace"),St=Ut([" ","\t","\r","\n"],!1,!1),Et=function(t,e){return function(t,e){if(e.marker&&e.marker.comment){let t=e.root;for(;;){const s=t.variations[0];if(!s){t.comment=e.marker.comment;break}t=s}}return{headers:t,root:e.root,result:(e.marker&&e.marker.result)??void 0}}(t,e)},xt=function(t){return Object.fromEntries(t)},Nt=function(t,e){return[t,e]},At=function(t,e){return{root:t,marker:e}},Mt=function(t,e){return function(...t){const[e,...s]=t;let n=e;for(const i of s)null!==i&&(n.variations=[i,...i.variations],i.variations=[],n=i);return e}(function(t){return null!==t?{comment:t,variations:[]}:{variations:[]}}(t),...e.flat())},jt=function(t,e,s,n,i){return function(t,e,s,n,i){const r={move:t,variations:i};return e&&(r.suffix=e),s&&(r.nag=s),null!==n&&(r.comment=n),r}(t,e,s,n,i)},Pt=function(t){return t},It=function(t){return t.replace(/[\r\n]+/g," ")},Tt=function(t){return t.trim()},Ot=function(t){return t},Lt=function(t,e){return{result:t,comment:e}},qt=0|e.peg$currPos,Kt=[{line:1,column:1}],Rt=qt,Bt=e.peg$maxFailExpected||[],Ft=0|e.peg$silentFails;if(e.startRule){if(!(e.startRule in h))throw new Error("Can't start parsing from rule \""+e.startRule+'".');c=h[e.startRule]}function Dt(t,e){return{type:"literal",text:t,ignoreCase:e}}function Ut(t,e,s){return{type:"class",parts:t,inverted:e,ignoreCase:s}}function $t(t){return{type:"other",description:t}}function zt(e){var s,n=Kt[e];if(n)return n;if(e>=Kt.length)s=Kt.length-1;else for(s=e;!Kt[--s];);for(n={line:(n=Kt[s]).line,column:n.column};s<e;)10===t.charCodeAt(s)?(n.line++,n.column=1):n.column++,s++;return Kt[e]=n,n}function Ht(t,e,s){var n=zt(t),i=zt(e);return{source:l,start:{offset:t,line:n.line,column:n.column},end:{offset:e,line:i.line,column:i.column}}}function Qt(t){qt<Rt||(qt>Rt&&(Rt=qt,Bt=[]),Bt.push(t))}function Vt(){var e,s;return e=function(){var t,e,s;t=qt,e=[],s=Wt();for(;s!==a;)e.push(s),s=Wt();return s=te(),t=xt(e),t}(),s=function(){var e,s,n;e=qt,s=Gt(),te(),n=function(){var e,s,n;Ft++,e=qt,t.substr(qt,3)===E?(s=E,qt+=3):(s=a,0===Ft&&Qt(bt));s===a&&(t.substr(qt,3)===x?(s=x,qt+=3):(s=a,0===Ft&&Qt(kt)),s===a&&(t.substr(qt,7)===N?(s=N,qt+=7):(s=a,0===Ft&&Qt(yt)),s===a&&(42===t.charCodeAt(qt)?(s=A,qt++):(s=a,0===Ft&&Qt(wt)))));s!==a?(te(),(n=Jt())===a&&(n=null),e=Lt(s,n)):(qt=e,e=a);Ft--,e===a&&(s=a,0===Ft&&Qt(vt));return e}(),n===a&&(n=null);return te(),e=At(s,n),e}(),Et(e,s)}function Wt(){var e,s,n,i,r,o,l;return Ft++,e=qt,te(),91===t.charCodeAt(qt)?(s=u,qt++):(s=a,0===Ft&&Qt(F)),s!==a?(te(),n=function(){var e,s,n;Ft++,e=qt,s=[],n=t.charAt(qt),M.test(n)?qt++:(n=a,0===Ft&&Qt(z));if(n!==a)for(;n!==a;)s.push(n),n=t.charAt(qt),M.test(n)?qt++:(n=a,0===Ft&&Qt(z));else s=a;e=s!==a?t.substring(e,qt):s;Ft--,e===a&&(s=a,0===Ft&&Qt($));return e}(),n!==a?(te(),34===t.charCodeAt(qt)?(i=f,qt++):(i=a,0===Ft&&Qt(D)),i!==a?(r=function(){var e,s,n;Ft++,e=qt,s=[],n=t.charAt(qt),j.test(n)?qt++:(n=a,0===Ft&&Qt(Q));for(;n!==a;)s.push(n),n=t.charAt(qt),j.test(n)?qt++:(n=a,0===Ft&&Qt(Q));e=t.substring(e,qt),Ft--,s=a,0===Ft&&Qt(H);return e}(),34===t.charCodeAt(qt)?(o=f,qt++):(o=a,0===Ft&&Qt(D)),o!==a?(te(),93===t.charCodeAt(qt)?(l=d,qt++):(l=a,0===Ft&&Qt(U)),l!==a?e=Nt(n,r):(qt=e,e=a)):(qt=e,e=a)):(qt=e,e=a)):(qt=e,e=a)):(qt=e,e=a),Ft--,e===a&&0===Ft&&Qt(B),e}function Gt(){var t,e,s;for((t=Jt())===a&&(t=null),e=[],s=Yt();s!==a;)e.push(s),s=Yt();return Mt(t,e)}function Yt(){var e,s,n,i,r,o,l,h;if(e=qt,te(),function(){var e,s,n,i,r,o;Ft++,e=qt,s=[],n=t.charAt(qt),P.test(n)?qt++:(n=a,0===Ft&&Qt(W));for(;n!==a;)s.push(n),n=t.charAt(qt),P.test(n)?qt++:(n=a,0===Ft&&Qt(W));46===t.charCodeAt(qt)?(n=p,qt++):(n=a,0===Ft&&Qt(G));if(n!==a){for(i=te(),r=[],o=t.charAt(qt),I.test(o)?qt++:(o=a,0===Ft&&Qt(Y));o!==a;)r.push(o),o=t.charAt(qt),I.test(o)?qt++:(o=a,0===Ft&&Qt(Y));e=s=[s,n,i,r]}else qt=e,e=a;Ft--,e===a&&(s=a,0===Ft&&Qt(V))}(),te(),s=function(){var e,s,n,i,r,o;Ft++,e=qt,s=qt,t.substr(qt,5)===m?(n=m,qt+=5):(n=a,0===Ft&&Qt(J));if(n===a&&(t.substr(qt,3)===g?(n=g,qt+=3):(n=a,0===Ft&&Qt(X)),n===a&&(t.substr(qt,5)===_?(n=_,qt+=5):(n=a,0===Ft&&Qt(tt)),n===a&&(t.substr(qt,3)===v?(n=v,qt+=3):(n=a,0===Ft&&Qt(et)),n===a))))if(n=qt,i=t.charAt(qt),M.test(i)?qt++:(i=a,0===Ft&&Qt(z)),i!==a){if(r=[],o=t.charAt(qt),T.test(o)?qt++:(o=a,0===Ft&&Qt(st)),o!==a)for(;o!==a;)r.push(o),o=t.charAt(qt),T.test(o)?qt++:(o=a,0===Ft&&Qt(st));else r=a;r!==a?n=i=[i,r]:(qt=n,n=a)}else qt=n,n=a;n!==a?(i=t.charAt(qt),O.test(i)?qt++:(i=a,0===Ft&&Qt(nt)),i===a&&(i=null),s=n=[n,i]):(qt=s,s=a);e=s!==a?t.substring(e,qt):s;Ft--,e===a&&(s=a,0===Ft&&Qt(Z));return e}(),s!==a){for(n=function(){var e,s,n;Ft++,e=qt,s=[],n=t.charAt(qt),L.test(n)?qt++:(n=a,0===Ft&&Qt(rt));for(;n!==a;)s.push(n),s.length>=2?n=a:(n=t.charAt(qt),L.test(n)?qt++:(n=a,0===Ft&&Qt(rt)));s.length<1?(qt=e,e=a):e=s;Ft--,e===a&&(s=a,0===Ft&&Qt(it));return e}(),n===a&&(n=null),i=[],r=Zt();r!==a;)i.push(r),r=Zt();for(r=te(),(o=Jt())===a&&(o=null),l=[],h=Xt();h!==a;)l.push(h),h=Xt();e=jt(s,n,i,o,l)}else qt=e,e=a;return e}function Zt(){var e,s,n,i,r;if(Ft++,e=qt,te(),36===t.charCodeAt(qt)?(s=b,qt++):(s=a,0===Ft&&Qt(at)),s!==a){if(n=qt,i=[],r=t.charAt(qt),P.test(r)?qt++:(r=a,0===Ft&&Qt(W)),r!==a)for(;r!==a;)i.push(r),r=t.charAt(qt),P.test(r)?qt++:(r=a,0===Ft&&Qt(W));else i=a;(n=i!==a?t.substring(n,qt):i)!==a?e=Pt(n):(qt=e,e=a)}else qt=e,e=a;return Ft--,e===a&&0===Ft&&Qt(ot),e}function Jt(){var e;return(e=function(){var e,s,n,i,r;Ft++,e=qt,123===t.charCodeAt(qt)?(s=k,qt++):(s=a,0===Ft&&Qt(ht));if(s!==a){for(n=qt,i=[],r=t.charAt(qt),q.test(r)?qt++:(r=a,0===Ft&&Qt(ct));r!==a;)i.push(r),r=t.charAt(qt),q.test(r)?qt++:(r=a,0===Ft&&Qt(ct));n=t.substring(n,qt),125===t.charCodeAt(qt)?(i=y,qt++):(i=a,0===Ft&&Qt(ut)),i!==a?e=It(n):(qt=e,e=a)}else qt=e,e=a;Ft--,e===a&&(s=a,0===Ft&&Qt(lt));return e}())===a&&(e=function(){var e,s,n,i,r;Ft++,e=qt,59===t.charCodeAt(qt)?(s=w,qt++):(s=a,0===Ft&&Qt(dt));if(s!==a){for(n=qt,i=[],r=t.charAt(qt),K.test(r)?qt++:(r=a,0===Ft&&Qt(pt));r!==a;)i.push(r),r=t.charAt(qt),K.test(r)?qt++:(r=a,0===Ft&&Qt(pt));n=t.substring(n,qt),e=Tt(n)}else qt=e,e=a;Ft--,e===a&&(s=a,0===Ft&&Qt(ft));return e}()),e}function Xt(){var e,s,n,i;return Ft++,e=qt,te(),40===t.charCodeAt(qt)?(s=C,qt++):(s=a,0===Ft&&Qt(gt)),s!==a&&(n=Gt())!==a?(te(),41===t.charCodeAt(qt)?(i=S,qt++):(i=a,0===Ft&&Qt(_t)),i!==a?e=Ot(n):(qt=e,e=a)):(qt=e,e=a),Ft--,e===a&&0===Ft&&Qt(mt),e}function te(){var e,s;for(Ft++,e=[],s=t.charAt(qt),R.test(s)?qt++:(s=a,0===Ft&&Qt(St));s!==a;)e.push(s),s=t.charAt(qt),R.test(s)?qt++:(s=a,0===Ft&&Qt(St));return Ft--,s=a,0===Ft&&Qt(Ct),e}if(s=c(),e.peg$library)return{peg$result:s,peg$currPos:qt,peg$FAILED:a,peg$maxFailExpected:Bt,peg$maxFailPos:Rt};if(s!==a&&qt===t.length)return s;throw s!==a&&qt<t.length&&Qt({type:"end"}),n=Bt,i=Rt<t.length?t.charAt(Rt):null,o=Rt<t.length?Ht(Rt,Rt+1):Ht(Rt,Rt),new r(r.buildMessage(n,i),n,i,o)}
/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */!function(t,e){function s(){this.constructor=t}s.prototype=e.prototype,t.prototype=new s}(r,Error),r.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var s,n=null;for(s=0;s<t.length;s++)if(t[s].source===this.location.source){n=t[s].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,r=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(i):i,a=this.location.source+":"+r.line+":"+r.column;if(n){var l=this.location.end,h=o("",r.line.toString().length," "),c=n[i.line-1],u=(i.line===l.line?l.column:c.length+1)-i.column||1;e+="\n --\x3e "+a+"\n"+h+" |\n"+r.line+" | "+c+"\n"+h+" | "+o("",i.column-1," ")+o("",u,"^")}else e+="\n at "+a}return e},r.buildMessage=function(t,e){var s,n={literal:function(t){return'"'+r(t.text)+'"'},class:function(t){var e=t.parts.map(function(t){return Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t)});return"["+(t.inverted?"^":"")+e.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function i(t){return t.charCodeAt(0).toString(16).toUpperCase()}function r(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+i(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+i(t)})}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+i(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+i(t)})}function a(t){return n[t.type](t)}return"Expected "+function(t){var e,s,n=t.map(a);if(n.sort(),n.length>0){for(e=1,s=1;e<n.length;e++)n[e-1]!==n[e]&&(n[s]=n[e],s++);n.length=s}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+(((s=e)?'"'+r(s)+'"':"end of input")+" found.")};const l=0xffffffffffffffffn;function h(t,e){return 0xffffffffffffffffn&(t<<e|t>>64n-e)}function c(t,e){return t*e&l}const u=(f=0xa187eb39cdcaed8f31c4b365b102e01en,function(){let t=BigInt(f&l),e=BigInt(f>>64n&l);const s=c(h(c(t,5n),7n),9n);return e^=t,t=(h(t,24n)^e^e<<16n)&l,e=h(e,37n),f=e<<64n|t,s});var f;const d=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>u()))),p=Array.from({length:8},()=>u()),m=Array.from({length:16},()=>u()),g=u(),_="w",v="b",b="p",k="b",y="r",w="q",C="k",S="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class E{constructor(t,s){e(this,"color"),e(this,"from"),e(this,"to"),e(this,"piece"),e(this,"captured"),e(this,"promotion"),e(this,"flags"),e(this,"san"),e(this,"lan"),e(this,"before"),e(this,"after");const{color:n,piece:i,from:r,to:o,flags:a,captured:l,promotion:h}=s,c=H(r),u=H(o);this.color=n,this.piece=i,this.from=c,this.to=u,this.san=t._moveToSan(s,t._moves({legal:!0})),this.lan=c+u,this.before=t.fen(),t._makeMove(s),this.after=t.fen(),t._undoMove(),this.flags="";for(const e in A)A[e]&a&&(this.flags+=N[e]);l&&(this.captured=l),h&&(this.promotion=h,this.lan+=h)}isCapture(){return this.flags.indexOf(N.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(N.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(N.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(N.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(N.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(N.BIG_PAWN)>-1}}const x=-1,N={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},A={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},M={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},j={...M,WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},P={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},I={b:[16,32,17,15],w:[-16,-32,-17,-15]},T={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},O=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],L=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],q={p:1,n:2,b:4,r:8,q:16,k:32},K=["n",k,y,w],R={[C]:A.KSIDE_CASTLE,[w]:A.QSIDE_CASTLE},B={w:[{square:P.a1,flag:A.QSIDE_CASTLE},{square:P.h1,flag:A.KSIDE_CASTLE}],b:[{square:P.a8,flag:A.QSIDE_CASTLE},{square:P.h8,flag:A.KSIDE_CASTLE}]},F={b:1,w:6},D="--";function U(t){return t>>4}function $(t){return 15&t}function z(t){return-1!=="0123456789".indexOf(t)}function H(t){const e=$(t),s=U(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(s,s+1)}function Q(t){return t===_?v:_}function V(t,e,s,n,i,r=void 0,o=A.NORMAL){const a=U(n);if(i!==b||7!==a&&0!==a)t.push({color:e,from:s,to:n,piece:i,captured:r,flags:o});else for(let l=0;l<K.length;l++){const a=K[l];t.push({color:e,from:s,to:n,piece:i,captured:r,promotion:a,flags:o|A.PROMOTION})}}function W(t){let e=t.charAt(0);if(e>="a"&&e<="h"){if(t.match(/[a-h]\d.*[a-h]\d/))return;return b}return e=e.toLowerCase(),"o"===e?C:e}function G(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Y{constructor(t=S,{skipValidation:s=!1}={}){e(this,"_board",new Array(128)),e(this,"_turn",_),e(this,"_header",{}),e(this,"_kings",{w:x,b:x}),e(this,"_epSquare",-1),e(this,"_halfMoves",0),e(this,"_moveNumber",0),e(this,"_history",[]),e(this,"_comments",{}),e(this,"_castling",{w:0,b:0}),e(this,"_hash",0n),e(this,"_positionCount",new Map),this.load(t,{skipValidation:s})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:x,b:x},this._turn=_,this._castling={w:0,b:0},this._epSquare=x,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...j},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:e=!1,preserveHeaders:s=!1}={}){let n=t.split(/\s+/);if(n.length>=2&&n.length<6){const e=["-","-","0","1"];t=n.concat(e.slice(-(6-n.length))).join(" ")}if(n=t.split(/\s+/),!e){const{ok:e,error:s}=function(t){const e=t.split(/\s+/);if(6!==e.length)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const s=parseInt(e[5],10);if(isNaN(s)||s<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const n=parseInt(e[4],10);if(isNaN(n)||n<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=e[0].split("/");if(8!==i.length)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let o=0;o<i.length;o++){let t=0,e=!1;for(let s=0;s<i[o].length;s++)if(z(i[o][s])){if(e)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};t+=parseInt(i[o][s],10),e=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[o][s]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};t+=1,e=!1}if(8!==t)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if("3"==e[3][1]&&"w"==e[1]||"6"==e[3][1]&&"b"==e[1])return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const r=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:o,regex:a}of r){if(!a.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${o} king`};if((e[0].match(a)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${o} kings`}}return Array.from(i[0]+i[7]).some(t=>"P"===t.toUpperCase())?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}(t);if(!e)throw new Error(s)}const i=n[0];let r=0;this.clear({preserveHeaders:s});for(let o=0;o<i.length;o++){const t=i.charAt(o);if("/"===t)r+=8;else if(z(t))r+=parseInt(t,10);else{const e=t<"a"?_:v;this._put({type:t.toLowerCase(),color:e},H(r)),r++}}this._turn=n[1],n[2].indexOf("K")>-1&&(this._castling.w|=A.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(this._castling.w|=A.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(this._castling.b|=A.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(this._castling.b|=A.QSIDE_CASTLE),this._epSquare="-"===n[3]?x:P[n[3]],this._halfMoves=parseInt(n[4],10),this._moveNumber=parseInt(n[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){var e,s;let n=0,i="";for(let a=P.a8;a<=P.h1;a++){if(this._board[a]){n>0&&(i+=n,n=0);const{color:t,type:e}=this._board[a];i+=t===_?e.toUpperCase():e.toLowerCase()}else n++;a+1&136&&(n>0&&(i+=n),a!==P.h1&&(i+="/"),n=0,a+=8)}let r="";this._castling[_]&A.KSIDE_CASTLE&&(r+="K"),this._castling[_]&A.QSIDE_CASTLE&&(r+="Q"),this._castling[v]&A.KSIDE_CASTLE&&(r+="k"),this._castling[v]&A.QSIDE_CASTLE&&(r+="q"),r=r||"-";let o="-";if(this._epSquare!==x)if(t)o=H(this._epSquare);else{const t=this._epSquare+(this._turn===_?16:-16),n=[t+1,t-1];for(const i of n){if(136&i)continue;const t=this._turn;if((null==(e=this._board[i])?void 0:e.color)===t&&(null==(s=this._board[i])?void 0:s.type)===b){this._makeMove({color:t,from:i,to:this._epSquare,piece:b,captured:b,flags:A.EP_CAPTURE});const e=!this._isKingAttacked(t);if(this._undoMove(),e){o=H(this._epSquare);break}}}}return[i,this._turn,r,o,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:e,type:s}=this._board[t],n={p:0,n:1,b:2,r:3,q:4,k:5}[s];return d[{w:0,b:1}[e]][n][t]}_epKey(){return this._epSquare===x?0n:p[7&this._epSquare]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return m[t]}_computeHash(){let t=0n;for(let e=P.a8;e<=P.h1;e++)136&e?e+=7:this._board[e]&&(t^=this._pieceKey(e));return t^=this._epKey(),t^=this._castlingKey(),"b"===this._turn&&(t^=g),t}_updateSetup(t){this._history.length>0||(t!==S?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(S)}get(t){return this._board[P[t]]}findPiece(t){var e;const s=[];for(let n=P.a8;n<=P.h1;n++)136&n?n+=7:this._board[n]&&(null==(e=this._board[n])?void 0:e.color)===t.color&&this._board[n].color===t.color&&this._board[n].type===t.type&&s.push(H(n));return s}put({type:t,color:e},s){return!!this._put({type:t,color:e},s)&&(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}_set(t,e){this._hash^=this._pieceKey(t),this._board[t]=e,this._hash^=this._pieceKey(t)}_put({type:t,color:e},s){if(-1==="pnbrqkPNBRQK".indexOf(t.toLowerCase()))return!1;if(!(s in P))return!1;const n=P[s];if(t==C&&this._kings[e]!=x&&this._kings[e]!=n)return!1;const i=this._board[n];return i&&i.type===C&&(this._kings[i.color]=x),this._set(n,{type:t,color:e}),t===C&&(this._kings[e]=n),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const e=this.get(t);return this._clear(P[t]),e&&e.type===C&&(this._kings[e.color]=x),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),e}_updateCastlingRights(){var t,e,s,n,i,r,o,a,l,h,c,u;this._hash^=this._castlingKey();const f=(null==(t=this._board[P.e1])?void 0:t.type)===C&&(null==(e=this._board[P.e1])?void 0:e.color)===_,d=(null==(s=this._board[P.e8])?void 0:s.type)===C&&(null==(n=this._board[P.e8])?void 0:n.color)===v;f&&(null==(i=this._board[P.a1])?void 0:i.type)===y&&(null==(r=this._board[P.a1])?void 0:r.color)===_||(this._castling.w&=-65),f&&(null==(o=this._board[P.h1])?void 0:o.type)===y&&(null==(a=this._board[P.h1])?void 0:a.color)===_||(this._castling.w&=-33),d&&(null==(l=this._board[P.a8])?void 0:l.type)===y&&(null==(h=this._board[P.a8])?void 0:h.color)===v||(this._castling.b&=-65),d&&(null==(c=this._board[P.h8])?void 0:c.type)===y&&(null==(u=this._board[P.h8])?void 0:u.color)===v||(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var t,e;if(this._epSquare===x)return;const s=this._epSquare+(this._turn===_?-16:16),n=this._epSquare+(this._turn===_?16:-16),i=[n+1,n-1];if(null!==this._board[s]||null!==this._board[this._epSquare]||(null==(t=this._board[n])?void 0:t.color)!==Q(this._turn)||(null==(e=this._board[n])?void 0:e.type)!==b)return this._hash^=this._epKey(),void(this._epSquare=x);i.some(t=>{var e,s;return!(136&t)&&(null==(e=this._board[t])?void 0:e.color)===this._turn&&(null==(s=this._board[t])?void 0:s.type)===b})||(this._hash^=this._epKey(),this._epSquare=x)}_attacked(t,e,s){const n=[];for(let i=P.a8;i<=P.h1;i++){if(136&i){i+=7;continue}if(void 0===this._board[i]||this._board[i].color!==t)continue;const r=this._board[i],o=i-e;if(0===o)continue;const a=o+119;if(O[a]&q[r.type]){if(r.type===b){if(o>0&&r.color===_||o<=0&&r.color===v){if(!s)return!0;n.push(H(i))}continue}if("n"===r.type||"k"===r.type){if(s){n.push(H(i));continue}return!0}const t=L[a];let l=i+t,h=!1;for(;l!==e;){if(null!=this._board[l]){h=!0;break}l+=t}if(!h){if(s){n.push(H(i));continue}return!0}}}return!!s&&n}attackers(t,e){return e?this._attacked(e,P[t],!0):this._attacked(this._turn,P[t],!0)}_isKingAttacked(t){const e=this._kings[t];return-1!==e&&this._attacked(Q(t),e)}hash(){return this._hash.toString(16)}isAttacked(t,e){return this._attacked(e,P[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&0===this._moves().length}isStalemate(){return!this.isCheck()&&0===this._moves().length}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},e=[];let s=0,n=0;for(let i=P.a8;i<=P.h1;i++){if(n=(n+1)%2,136&i){i+=7;continue}const r=this._board[i];r&&(t[r.type]=r.type in t?t[r.type]+1:1,r.type===k&&e.push(n),s++)}if(2===s)return!0;if(3===s&&(1===t[k]||1===t.n))return!0;if(s===t[k]+2){let t=0;const s=e.length;for(let n=0;n<s;n++)t+=e[n];if(0===t||t===s)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:e,piece:s}={}){const n=this._moves({square:e,piece:s});return t?n.map(t=>new E(this,t)):n.map(t=>this._moveToSan(t,n))}_moves({legal:t=!0,piece:e,square:s}={}){var n;const i=s?s.toLowerCase():void 0,r=null==e?void 0:e.toLowerCase(),o=[],a=this._turn,l=Q(a);let h=P.a8,c=P.h1,u=!1;if(i){if(!(i in P))return[];h=c=P[i],u=!0}for(let d=h;d<=c;d++){if(136&d){d+=7;continue}if(!this._board[d]||this._board[d].color===l)continue;const{type:t}=this._board[d];let e;if(t===b){if(r&&r!==t)continue;e=d+I[a][0],this._board[e]||(V(o,a,d,e,b),e=d+I[a][1],F[a]!==U(d)||this._board[e]||V(o,a,d,e,b,void 0,A.BIG_PAWN));for(let t=2;t<4;t++)e=d+I[a][t],136&e||((null==(n=this._board[e])?void 0:n.color)===l?V(o,a,d,e,b,this._board[e].type,A.CAPTURE):e===this._epSquare&&V(o,a,d,e,b,b,A.EP_CAPTURE))}else{if(r&&r!==t)continue;for(let s=0,n=T[t].length;s<n;s++){const n=T[t][s];for(e=d;e+=n,!(136&e);){if(this._board[e]){if(this._board[e].color===a)break;V(o,a,d,e,t,this._board[e].type,A.CAPTURE);break}if(V(o,a,d,e,t),"n"===t||t===C)break}}}}if(!(void 0!==r&&r!==C||u&&c!==this._kings[a])){if(this._castling[a]&A.KSIDE_CASTLE){const t=this._kings[a],e=t+2;this._board[t+1]||this._board[e]||this._attacked(l,this._kings[a])||this._attacked(l,t+1)||this._attacked(l,e)||V(o,a,this._kings[a],e,C,void 0,A.KSIDE_CASTLE)}if(this._castling[a]&A.QSIDE_CASTLE){const t=this._kings[a],e=t-2;this._board[t-1]||this._board[t-2]||this._board[t-3]||this._attacked(l,this._kings[a])||this._attacked(l,t-1)||this._attacked(l,e)||V(o,a,this._kings[a],e,C,void 0,A.QSIDE_CASTLE)}}if(!t||-1===this._kings[a])return o;const f=[];for(let d=0,p=o.length;d<p;d++)this._makeMove(o[d]),this._isKingAttacked(a)||f.push(o[d]),this._undoMove();return f}move(t,{strict:e=!1}={}){let s=null;if("string"==typeof t)s=this._moveFromSan(t,e);else if(null===t)s=this._moveFromSan(D,e);else if("object"==typeof t){const e=this._moves();for(let n=0,i=e.length;n<i;n++)if(t.from===H(e[n].from)&&t.to===H(e[n].to)&&(!("promotion"in e[n])||t.promotion===e[n].promotion)){s=e[n];break}}if(!s)throw"string"==typeof t?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);if(this.isCheck()&&s.flags&A.NULL_MOVE)throw new Error("Null move not allowed when in check");const n=new E(this,s);return this._makeMove(s),this._incPositionCount(),n}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,e){this._hash^=this._pieceKey(t),this._board[e]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(e)}_makeMove(t){var e,s,n,i;const r=this._turn,o=Q(r);if(this._push(t),t.flags&A.NULL_MOVE)return r===v&&this._moveNumber++,this._halfMoves++,this._turn=o,void(this._epSquare=x);if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&A.EP_CAPTURE&&(this._turn===v?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:r})),this._board[t.to].type===C){if(this._kings[r]=t.to,t.flags&A.KSIDE_CASTLE){const e=t.to-1,s=t.to+1;this._movePiece(s,e)}else if(t.flags&A.QSIDE_CASTLE){const e=t.to+1,s=t.to-2;this._movePiece(s,e)}this._castling[r]=0}if(this._castling[r])for(let a=0,l=B[r].length;a<l;a++)if(t.from===B[r][a].square&&this._castling[r]&B[r][a].flag){this._castling[r]^=B[r][a].flag;break}if(this._castling[o])for(let a=0,l=B[o].length;a<l;a++)if(t.to===B[o][a].square&&this._castling[o]&B[o][a].flag){this._castling[o]^=B[o][a].flag;break}if(this._hash^=this._castlingKey(),t.flags&A.BIG_PAWN){let a;a=r===v?t.to-16:t.to+16,(t.to-1&136||(null==(e=this._board[t.to-1])?void 0:e.type)!==b||(null==(s=this._board[t.to-1])?void 0:s.color)!==o)&&(t.to+1&136||(null==(n=this._board[t.to+1])?void 0:n.type)!==b||(null==(i=this._board[t.to+1])?void 0:i.color)!==o)?this._epSquare=x:(this._epSquare=a,this._hash^=this._epKey())}else this._epSquare=x;t.piece===b||t.flags&(A.CAPTURE|A.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,r===v&&this._moveNumber++,this._turn=o,this._hash^=g}undo(){const t=this._hash,e=this._undoMove();if(e){const s=new E(this,e);return this._decPositionCount(t),s}return null}_undoMove(){const t=this._history.pop();if(void 0===t)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const e=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=g;const s=this._turn,n=Q(s);if(e.flags&A.NULL_MOVE)return e;if(this._movePiece(e.to,e.from),e.piece&&(this._clear(e.from),this._set(e.from,{type:e.piece,color:s})),e.captured)if(e.flags&A.EP_CAPTURE){let t;t=s===v?e.to-16:e.to+16,this._set(t,{type:b,color:n})}else this._set(e.to,{type:e.captured,color:n});if(e.flags&(A.KSIDE_CASTLE|A.QSIDE_CASTLE)){let t,s;e.flags&A.KSIDE_CASTLE?(t=e.to+1,s=e.to-1):(t=e.to-2,s=e.to+1),this._movePiece(s,t)}return e}pgn({newline:t="\n",maxWidth:e=0}={}){const s=[];let n=!1;for(const u in this._header){this._header[u]&&s.push(`[${u} "${this._header[u]}"]`+t),n=!0}n&&this._history.length&&s.push(t);const i=t=>{const e=this._comments[this.fen()];if(void 0!==e){t=`${t}${t.length>0?" ":""}{${e}}`}return t},r=[];for(;this._history.length>0;)r.push(this._undoMove());const o=[];let a="";for(0===r.length&&o.push(i(""));r.length>0;){a=i(a);const t=r.pop();if(!t)break;if(this._history.length||"b"!==t.color)"w"===t.color&&(a.length&&o.push(a),a=this._moveNumber+".");else{const t=`${this._moveNumber}. ...`;a=a?`${a} ${t}`:t}a=a+" "+this._moveToSan(t,this._moves({legal:!0})),this._makeMove(t)}if(a.length&&o.push(i(a)),o.push(this._header.Result||"*"),0===e)return s.join("")+o.join(" ");const l=function(){return s.length>0&&" "===s[s.length-1]&&(s.pop(),!0)},h=function(n,i){for(const r of i.split(" "))if(r){if(n+r.length>e){for(;l();)n--;s.push(t),n=0}s.push(r),n+=r.length,s.push(" "),n++}return l()&&n--,n};let c=0;for(let u=0;u<o.length;u++)c+o[u].length>e&&o[u].includes("{")?c=h(c,o[u]):(c+o[u].length>e&&0!==u?(" "===s[s.length-1]&&s.pop(),s.push(t),c=0):0!==u&&(s.push(" "),c++),s.push(o[u]),c+=o[u].length);return s.join("")}header(...t){for(let e=0;e<t.length;e+=2)"string"==typeof t[e]&&"string"==typeof t[e+1]&&(this._header[t[e]]=t[e+1]);return this._header}setHeader(t,e){return this._header[t]=e??M[t]??null,this.getHeaders()}removeHeader(t){return t in this._header&&(this._header[t]=M[t]||null,!0)}getHeaders(){const t={};for(const[e,s]of Object.entries(this._header))null!==s&&(t[e]=s);return t}loadPgn(t,{strict:e=!1,newlineChar:s="\r?\n"}={}){"\r?\n"!==s&&(t=t.replace(new RegExp(s,"g"),"\n"));const n=a(t);this.reset();const i=n.headers;let r="";for(const a in i)"fen"===a.toLowerCase()&&(r=i[a]),this.header(a,i[a]);if(e){if("1"===i.SetUp){if(!("FEN"in i))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(i.FEN,{preserveHeaders:!0})}}else r&&this.load(r,{preserveHeaders:!0});let o=n.root;for(;o;){if(o.move){const t=this._moveFromSan(o.move,e);if(null==t)throw new Error(`Invalid move in PGN: ${o.move}`);this._makeMove(t),this._incPositionCount()}void 0!==o.comment&&(this._comments[this.fen()]=o.comment),o=o.variations[0]}const l=n.result;l&&Object.keys(this._header).length&&this._header.Result!==l&&this.setHeader("Result",l)}_moveToSan(t,e){let s="";if(t.flags&A.KSIDE_CASTLE)s="O-O";else if(t.flags&A.QSIDE_CASTLE)s="O-O-O";else{if(t.flags&A.NULL_MOVE)return D;if(t.piece!==b){const n=function(t,e){const s=t.from,n=t.to,i=t.piece;let r=0,o=0,a=0;for(let l=0,h=e.length;l<h;l++){const t=e[l].from,h=e[l].to;i===e[l].piece&&s!==t&&n===h&&(r++,U(s)===U(t)&&o++,$(s)===$(t)&&a++)}return r>0?o>0&&a>0?H(s):a>0?H(s).charAt(1):H(s).charAt(0):""}(t,e);s+=t.piece.toUpperCase()+n}t.flags&(A.CAPTURE|A.EP_CAPTURE)&&(t.piece===b&&(s+=H(t.from)[0]),s+="x"),s+=H(t.to),t.promotion&&(s+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(t,e=!1){let s=G(t);if(e||("0-0"===s?s="O-O":"0-0-0"===s&&(s="O-O-O")),s==D){return{color:this._turn,from:0,to:0,piece:"k",flags:A.NULL_MOVE}}let n,i,r,o,a,l=W(s),h=this._moves({legal:!0,piece:l});for(let u=0,f=h.length;u<f;u++)if(s===G(this._moveToSan(h[u],h)))return h[u];if(e)return null;let c=!1;if(i=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),i?(n=i[1],r=i[2],o=i[3],a=i[4],1==r.length&&(c=!0)):(i=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),i&&(n=i[1],r=i[2],o=i[3],a=i[4],1==r.length&&(c=!0))),l=W(s),h=this._moves({legal:!0,piece:n||l}),!o)return null;for(let u=0,f=h.length;u<f;u++)if(r){if(!(n&&n.toLowerCase()!=h[u].piece||P[r]!=h[u].from||P[o]!=h[u].to||a&&a.toLowerCase()!=h[u].promotion))return h[u];if(c){const t=H(h[u].from);if(!(n&&n.toLowerCase()!=h[u].piece||P[o]!=h[u].to||r!=t[0]&&r!=t[1]||a&&a.toLowerCase()!=h[u].promotion))return h[u]}}else if(s===G(this._moveToSan(h[u],h)).replace("x",""))return h[u];return null}ascii(){let t="   +------------------------+\n";for(let e=P.a8;e<=P.h1;e++){if(0===$(e)&&(t+=" "+"87654321"[U(e)]+" |"),this._board[e]){const s=this._board[e].type;t+=" "+(this._board[e].color===_?s.toUpperCase():s.toLowerCase())+" "}else t+=" . ";e+1&136&&(t+="|\n",e+=8)}return t+="   +------------------------+\n",t+="     a  b  c  d  e  f  g  h",t}perft(t){const e=this._moves({legal:!1});let s=0;const n=this._turn;for(let i=0,r=e.length;i<r;i++)this._makeMove(e[i]),this._isKingAttacked(n)||(t-1>0?s+=this.perft(t-1):s++),this._undoMove();return s}setTurn(t){return this._turn!=t&&(this.move("--"),!0)}turn(){return this._turn}board(){const t=[];let e=[];for(let s=P.a8;s<=P.h1;s++)null==this._board[s]?e.push(null):e.push({square:H(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(t.push(e),e=[],s+=8);return t}squareColor(t){if(t in P){const e=P[t];return(U(e)+$(e))%2==0?"light":"dark"}return null}history({verbose:t=!1}={}){const e=[],s=[];for(;this._history.length>0;)e.push(this._undoMove());for(;;){const n=e.pop();if(!n)break;t?s.push(new E(this,n)):s.push(this._moveToSan(n,this._moves())),this._makeMove(n)}return s}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const e=this._positionCount.get(t)??0;1===e?this._positionCount.delete(t):this._positionCount.set(t,e-1)}_pruneComments(){const t=[],e={},s=t=>{t in this._comments&&(e[t]=this._comments[t])};for(;this._history.length>0;)t.push(this._undoMove());for(s(this.fen());;){const e=t.pop();if(!e)break;this._makeMove(e),s(this.fen())}this._comments=e}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const e=this._comments[t];return delete this._comments[t],{fen:t,comment:e}})}setCastlingRights(t,e){for(const n of[C,w])void 0!==e[n]&&(e[n]?this._castling[t]|=R[n]:this._castling[t]&=~R[n]);this._updateCastlingRights();const s=this.getCastlingRights(t);return!(void 0!==e[C]&&e[C]!==s[C]||void 0!==e[w]&&e[w]!==s[w])}getCastlingRights(t){return{[C]:0!==(this._castling[t]&R[C]),[w]:0!==(this._castling[t]&R[w])}}moveNumber(){return this._moveNumber}}class Z{constructor(){this.engine=null,this.onMoveCallback=null,this._isReady=!1}get isReady(){return this._isReady}async init(){return new Promise(t=>{this.engine=new Worker("/redoxchess.js"),this.engine.onmessage=e=>{const s=e.data;if("readyok"===s)this._isReady=!0,t();else if(s.startsWith("bestmove")){const t=s.split(" ")[1];this.onMoveCallback&&this.onMoveCallback(t)}},this.send("uci"),this.send("isready")})}send(t){this.engine&&this.engine.postMessage(t)}setPosition(t){this.send(`position fen ${t}`)}getBestMove(t,e=15){this.onMoveCallback=t,this.send(`go depth ${e}`)}stop(){this.send("stop")}quit(){this.engine&&(this.send("quit"),this.engine.terminate(),this.engine=null)}}const J={wK:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45"><g fill="none" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path stroke-linejoin="miter" d="M22.5 11.63V6M20 8h5"/><path fill="#fff" stroke-linecap="butt" stroke-linejoin="miter" d="M22.5 25s4.5-7.5 3-10.5c0 0-1-2.5-3-2.5s-3 2.5-3 2.5c-1.5 3 3 10.5 3 10.5"/><path fill="#fff" d="M12.5 37c5.5 3.5 14.5 3.5 20 0v-7s9-4.5 6-10.5c-4-6.5-13.5-3.5-16 4V27v-3.5c-2.5-7.5-12-10.5-16-4-3 6 6 10.5 6 10.5v7"/><path d="M12.5 30c5.5-3 14.5-3 20 0m-20 3.5c5.5-3 14.5-3 20 0m-20 3.5c5.5-3 14.5-3 20 0"/></g></svg>',wQ:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45"><g fill="#fff" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M8 12a2 2 0 1 1-4 0 2 2 0 1 1 4 0zm16.5-4.5a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM41 12a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM16 9a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM33 9a2 2 0 1 1-4 0 2 2 0 1 1 4 0z"/><path stroke-linecap="butt" d="M9 26c8.5-1.5 21-1.5 27 0l2-12-7 11V11l-5.5 13.5-3-15-3 15L14 11v14L7 14l2 12z"/><path stroke-linecap="butt" d="M9 26c0 2 1.5 2 2.5 4 1 1.5 1 1 .5 3.5-1.5 1-1.5 2.5-1.5 2.5-1.5 1.5.5 2.5.5 2.5 6.5 1 16.5 1 23 0 0 0 1.5-1 0-2.5 0 0 .5-1.5-1-2.5-.5-2.5-.5-2 .5-3.5 1-2 2.5-2 2.5-4-8.5-1.5-18.5-1.5-27 0z"/><path fill="none" d="M11.5 30c3.5-1 18.5-1 22 0M12 33.5c6-1 15-1 21 0"/></g></svg>',wR:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45"><g fill="#fff" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path stroke-linecap="butt" d="M9 39h27v-3H9v3zm3-3v-4h21v4H12zm-1-22V9h4v2h5V9h5v2h5V9h4v5"/><path d="M34 14l-3 3H14l-3-3"/><path stroke-linecap="butt" stroke-linejoin="miter" d="M31 17v12.5H14V17"/><path d="M31 29.5l1.5 2.5h-20l1.5-2.5"/><path fill="none" stroke-linejoin="miter" d="M11 14h23"/></g></svg>',wB:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45"><g fill="none" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><g fill="#fff" stroke-linecap="butt"><path d="M9 36c3.39-.97 10.11.43 13.5-2 3.39 2.43 10.11 1.03 13.5 2 0 0 1.65.54 3 2-.68.97-1.65.99-3 .5-3.39-.97-10.11.46-13.5-1-3.39 1.46-10.11.03-13.5 1-1.35.49-2.32.47-3-.5 1.35-1.46 3-2 3-2z"/><path d="M15 32c2.5 2.5 12.5 2.5 15 0 .5-1.5 0-2 0-2 0-2.5-2.5-4-2.5-4 5.5-1.5 6-11.5-5-15.5-11 4-10.5 14-5 15.5 0 0-2.5 1.5-2.5 4 0 0-.5.5 0 2z"/><path d="M25 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 1 1 5 0z"/></g><path stroke-linejoin="miter" d="M17.5 26h10M15 30h15m-7.5-14.5v5M20 18h5"/></g></svg>',wN:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45"><g fill="none" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path fill="#fff" d="M22 10c10.5 1 16.5 8 16 29H15c0-9 10-6.5 8-21"/><path fill="#fff" d="M24 18c.38 2.91-5.55 7.37-8 9-3 2-2.82 4.34-5 4-1.042-.94 1.41-3.04 0-3-1 0 .19 1.23-1 2-1 0-4.003 1-4-4 0-2 6-12 6-12s1.89-1.9 2-3.5c-.73-.994-.5-2-.5-3 1-1 3 2.5 3 2.5h2s.78-1.992 2.5-3c1 0 1 3 1 3"/><path fill="#000" d="M9.5 25.5a.5.5 0 1 1-1 0 .5.5 0 1 1 1 0zm5.433-9.75a.5 1.5 30 1 1-.866-.5.5 1.5 30 1 1 .866.5z"/></g></svg>',wP:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45"><path fill="#fff" stroke="#000" stroke-width="1.5" stroke-linecap="round" d="M22.5 9c-2.21 0-4 1.79-4 4 0 .89.29 1.71.78 2.38C17.33 16.5 16 18.59 16 21c0 2.03.94 3.84 2.41 5.03-3 1.06-7.41 5.55-7.41 13.47h23c0-7.92-4.41-12.41-7.41-13.47 1.47-1.19 2.41-3 2.41-5.03 0-2.41-1.33-4.5-3.28-5.62.49-.67.78-1.49.78-2.38 0-2.21-1.79-4-4-4z"/></svg>',bK:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45"><g fill="none" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path stroke-linejoin="miter" d="M22.5 11.63V6" stroke="#c2a4ff"/><path fill="#1a1a2e" stroke="#c2a4ff" d="M20 8h5"/><path fill="#1a1a2e" stroke="#c2a4ff" stroke-linecap="butt" stroke-linejoin="miter" d="M22.5 25s4.5-7.5 3-10.5c0 0-1-2.5-3-2.5s-3 2.5-3 2.5c-1.5 3 3 10.5 3 10.5"/><path fill="#1a1a2e" stroke="#c2a4ff" d="M12.5 37c5.5 3.5 14.5 3.5 20 0v-7s9-4.5 6-10.5c-4-6.5-13.5-3.5-16 4V27v-3.5c-2.5-7.5-12-10.5-16-4-3 6 6 10.5 6 10.5v7"/><path stroke="#c2a4ff" d="M12.5 30c5.5-3 14.5-3 20 0m-20 3.5c5.5-3 14.5-3 20 0m-20 3.5c5.5-3 14.5-3 20 0"/></g></svg>',bQ:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45"><g fill-rule="evenodd" stroke="#c2a4ff" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><g fill="#1a1a2e"><circle cx="6" cy="12" r="2.75"/><circle cx="14" cy="9" r="2.75"/><circle cx="22.5" cy="8" r="2.75"/><circle cx="31" cy="9" r="2.75"/><circle cx="39" cy="12" r="2.75"/></g><path fill="#1a1a2e" stroke-linecap="butt" d="M9 26c8.5-1.5 21-1.5 27 0l2.5-12.5L31 25l-.3-14.1-5.2 13.6-3-14.5-3 14.5-5.2-13.6L14 25 6.5 13.5 9 26z"/><path fill="#1a1a2e" stroke-linecap="butt" d="M9 26c0 2 1.5 2 2.5 4 1 1.5 1 1 .5 3.5-1.5 1-1.5 2.5-1.5 2.5-1.5 1.5.5 2.5.5 2.5 6.5 1 16.5 1 23 0 0 0 1.5-1 0-2.5 0 0 .5-1.5-1-2.5-.5-2.5-.5-2 .5-3.5 1-2 2.5-2 2.5-4-8.5-1.5-18.5-1.5-27 0z"/><path fill="none" stroke-linecap="butt" d="M11 38.5a35 35 1 0 0 23 0"/><path fill="none" d="M11 29a35 35 1 0 1 23 0m-21.5 2.5h20m-21 3a35 35 1 0 0 22 0"/></g></svg>',bR:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45"><g fill-rule="evenodd" stroke="#c2a4ff" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path fill="#1a1a2e" stroke-linecap="butt" d="M9 39h27v-3H9v3zm3.5-7l1.5-2.5h17l1.5 2.5h-20zm-.5 4v-4h21v4H12z"/><path fill="#1a1a2e" stroke-linecap="butt" stroke-linejoin="miter" d="M14 29.5v-13h17v13H14z"/><path fill="#1a1a2e" stroke-linecap="butt" d="M14 16.5L11 14h23l-3 2.5H14zM11 14V9h4v2h5V9h5v2h5V9h4v5H11z"/><path fill="none" stroke-linejoin="miter" d="M12 35.5h21m-20-4h19m-18-2h17m-17-13h17M11 14h23"/></g></svg>',bB:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45"><g fill="none" fill-rule="evenodd" stroke="#c2a4ff" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><g fill="#1a1a2e" stroke-linecap="butt"><path d="M9 36c3.39-.97 10.11.43 13.5-2 3.39 2.43 10.11 1.03 13.5 2 0 0 1.65.54 3 2-.68.97-1.65.99-3 .5-3.39-.97-10.11.46-13.5-1-3.39 1.46-10.11.03-13.5 1-1.35.49-2.32.47-3-.5 1.35-1.46 3-2 3-2z"/><path d="M15 32c2.5 2.5 12.5 2.5 15 0 .5-1.5 0-2 0-2 0-2.5-2.5-4-2.5-4 5.5-1.5 6-11.5-5-15.5-11 4-10.5 14-5 15.5 0 0-2.5 1.5-2.5 4 0 0-.5.5 0 2z"/><path d="M25 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 1 1 5 0z"/></g><path stroke-linejoin="miter" d="M17.5 26h10M15 30h15m-7.5-14.5v5M20 18h5"/></g></svg>',bN:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45"><g fill="none" fill-rule="evenodd" stroke="#c2a4ff" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path fill="#1a1a2e" d="M22 10c10.5 1 16.5 8 16 29H15c0-9 10-6.5 8-21"/><path fill="#1a1a2e" d="M24 18c.38 2.91-5.55 7.37-8 9-3 2-2.82 4.34-5 4-1.042-.94 1.41-3.04 0-3-1 0 .19 1.23-1 2-1 0-4.003 1-4-4 0-2 6-12 6-12s1.89-1.9 2-3.5c-.73-.994-.5-2-.5-3 1-1 3 2.5 3 2.5h2s.78-1.992 2.5-3c1 0 1 3 1 3"/><path fill="#c2a4ff" d="M9.5 25.5a.5.5 0 1 1-1 0 .5.5 0 1 1 1 0zm5.433-9.75a.5 1.5 30 1 1-.866-.5.5 1.5 30 1 1 .866.5z"/></g></svg>',bP:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45"><path fill="#1a1a2e" stroke="#c2a4ff" stroke-width="1.5" stroke-linecap="round" d="M22.5 9c-2.21 0-4 1.79-4 4 0 .89.29 1.71.78 2.38C17.33 16.5 16 18.59 16 21c0 2.03.94 3.84 2.41 5.03-3 1.06-7.41 5.55-7.41 13.47h23c0-7.92-4.41-12.41-7.41-13.47 1.47-1.19 2.41-3 2.41-5.03 0-2.41-1.33-4.5-3.28-5.62.49-.67.78-1.49.78-2.38 0-2.21-1.79-4-4-4z"/></svg>'},X=()=>{const[t,e]=s.useState(new Y),[r,o]=s.useState(null),[a,l]=s.useState([]),[h,c]=s.useState([]),[u,f]=s.useState([]),[d,p]=s.useState([]),[m,g]=s.useState(!1),[_,v]=s.useState(null),[b,k]=s.useState(""),[y]=s.useState("w"),[w,C]=s.useState(!1),S=s.useRef(null),[E,x]=s.useState([{role:"assistant",content:"Hello there! I am Nippon Chowdhury ðŸ‘‹ Ask me anything you want to know!"}]),[N,A]=s.useState(""),[M,j]=s.useState(!1),P=m?["h","g","f","e","d","c","b","a"]:["a","b","c","d","e","f","g","h"],I=m?["1","2","3","4","5","6","7","8"]:["8","7","6","5","4","3","2","1"],T=s.useCallback(t=>{t.isCheckmate()?k("w"===t.turn()?"Checkmate! Black wins!":"Checkmate! White wins!"):t.isDraw()?t.isStalemate()?k("Draw by stalemate"):t.isThreefoldRepetition()?k("Draw by repetition"):t.isInsufficientMaterial()?k("Draw by insufficient material"):k("Draw"):t.isCheck()?k("w"===t.turn()?"White is in check!":"Black is in check!"):k("w"===t.turn()?"White's turn":"Black's turn")},[]);s.useEffect(()=>{T(t)},[t,T]),s.useEffect(()=>((async()=>{S.current=new Z,await S.current.init()})(),()=>{var t;null==(t=S.current)||t.quit()}),[]),s.useEffect(()=>{"b"===t.turn()&&!t.isGameOver()&&S.current&&(C(!0),S.current.setPosition(t.fen()),S.current.getBestMove(t=>{const e=t.substring(0,2),s=t.substring(2,4);L(e,s),C(!1)},12))},[t]);const O=e=>t.get(e)||null,L=(s,n)=>{try{const i=new Y(t.fen()),r=i.move({from:s,to:n,promotion:"q"});r&&(r.captured&&("w"===r.color?p(t=>[...t,r.captured]):f(t=>[...t,r.captured])),c(t=>[...t,{from:r.from,to:r.to,piece:r.piece,captured:r.captured,san:r.san}]),v({from:s,to:n}),e(i),o(null),l([]))}catch{o(null),l([])}},q=()=>{e(new Y),o(null),l([]),c([]),f([]),p([]),v(null),k("White's turn"),g(!1)},K=async()=>{var t,e;if(!N.trim())return;const s={role:"user",content:N};x(t=>[...t,s]),A(""),j(!0);try{const s=[{role:"system",content:'You are Nippon Chowdhury, a software developer from Chittagong, Bangladesh. You are NOT an AI assistant â€” you ARE Nippon himself chatting with visitors on your portfolio website.\n\nAbout you (Nippon Chowdhury):\n- Full name: Nippon Chowdhury\n- Location: Chittagong, Bangladesh\n- Background: Programming since 2019 (started with Stanford Code in Place - Python)\n- Education: BSc in Computer Science (Completed November 2025)\n- Focus: Android development (since 2021) transitioning into AI & Intelligent Software Systems\n- Specialties: Kotlin, Android architecture, Python, algorithms, backend integration, AI application integration\n- Projects: UniCalculator, BudgetM=Student, InnerLight (AI-based project), multiple Android utility apps\n- Interests: AI systems, software architecture, competitive programming, chess\n- Languages: Bengali (native), English (fluent)\n- Current Goal: Preparing for graduate studies focused on AI & Intelligent Software Systems\n\nPersonality:\n- Friendly, calm, and thoughtful\n- Analytical and growth-oriented\n- Honest about strengths and learning journey\n- Passionate about building real, practical systems\n\nRules:\n1. Always respond as Nippon in first person ("I", "my", "me")\n2. Keep responses natural and conversational but professional\n3. Share genuine experiences from your real journey\n4. If unsure about personal details, redirect to professional topics\n5. Keep responses concise and helpful\n6. You can discuss Android, AI, software engineering, algorithms, or chess\n7. Never say you are an AI or language model\n8. Occasionally use a light emoji if appropriate ðŸ˜Š'},...E.filter(t=>"system"!==t.role).map(t=>({role:t.role,content:t.content})),{role:"user",content:N}],n=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:s})}),i=await n.json();if(!i.choices||!(null==(e=null==(t=i.choices[0])?void 0:t.message)?void 0:e.content))throw new Error("Invalid response");{const t={role:"assistant",content:i.choices[0].message.content};x(e=>[...e,t])}}catch(n){const t={role:"assistant",content:"Sorry, having some connection issues. Try again? ðŸ˜…"};x(e=>[...e,t])}finally{j(!1)}},R=t=>{if(!t)return null;const e=`${t.color}${t.type.toUpperCase()}`,s=J[e];return s?n.jsx("div",{className:"chess-piece",dangerouslySetInnerHTML:{__html:s}}):null},B=(t,e)=>t.map((t,s)=>{const i=`${e}${t.toUpperCase()}`,r=J[i];return n.jsx("div",{className:"captured-piece",dangerouslySetInnerHTML:{__html:r||""}},s)});return n.jsxs("div",{className:"play-page",children:[n.jsx("div",{className:"play-header",children:n.jsx(i,{to:"/",className:"back-button","data-cursor":"disable",children:"â† Back to Home"})}),n.jsxs("div",{className:"chess-container",children:[n.jsxs("div",{className:"chat-panel",children:[n.jsx("div",{className:"chat-header",children:n.jsx("span",{className:"chat-title",children:"ðŸ’¬ Talk with me"})}),n.jsxs("div",{className:"chat-messages",children:[E.map((t,e)=>n.jsx("div",{className:`chat-message ${t.role}`,children:n.jsx("div",{className:"message-content",children:t.content})},e)),M&&n.jsx("div",{className:"chat-message assistant",children:n.jsxs("div",{className:"message-content typing",children:[n.jsx("span",{}),n.jsx("span",{}),n.jsx("span",{})]})})]}),n.jsxs("div",{className:"chat-input-area",children:[n.jsx("input",{type:"text",className:"chat-input",placeholder:"Type a message...",value:N,onChange:t=>A(t.target.value),onKeyPress:t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),K())},"data-cursor":"disable"}),n.jsx("button",{className:"chat-send-btn",onClick:K,"data-cursor":"disable",children:"âž¤"})]})]}),n.jsxs("div",{className:"chess-board-section",children:[n.jsxs("div",{className:"player-bar opponent-bar",children:[n.jsxs("div",{className:"player-info",children:[n.jsx("div",{className:"player-avatar",children:n.jsx("img",{src:"/images/mypic.jpeg",alt:"Nippon"})}),n.jsxs("div",{className:"player-details",children:[n.jsx("span",{className:"player-name",children:"Nippon"}),n.jsxs("span",{className:"player-rating",children:[w?"ðŸ¤” Thinking...":"Computer"," "]})]})]}),n.jsx("div",{className:"captured-pieces",children:B(u,"w")})]}),n.jsx("div",{className:"chess-board-wrapper",children:n.jsx("div",{className:"chess-board",children:I.map(e=>P.map(s=>{const i=`${s}${e}`,h=O(i),c=((t,e)=>("abcdefgh".indexOf(t)+(parseInt(e)-1))%2==1)(s,e),u=r===i,f=a.includes(i),d=_&&(_.from===i||_.to===i),p=t.isCheck()&&"k"===(null==h?void 0:h.type)&&(null==h?void 0:h.color)===t.turn();return n.jsxs("div",{className:`chess-square ${c?"light":"dark"} \n                        ${u?"selected":""} \n                        ${d?"last-move":""}\n                        ${p?"in-check":""}`,onClick:()=>(e=>{if(w||"w"!==t.turn())return;const s=O(e);if(r)if(a.includes(e))L(r,e);else if(s&&s.color===t.turn()){o(e);const s=t.moves({square:e,verbose:!0});l(s.map(t=>t.to))}else o(null),l([]);else if(s&&s.color===t.turn()){o(e);const s=t.moves({square:e,verbose:!0});l(s.map(t=>t.to))}})(i),"data-cursor":"disable",children:[s===(m?"h":"a")&&n.jsx("span",{className:"coord-rank",children:e}),e===(m?"8":"1")&&n.jsx("span",{className:"coord-file",children:s}),R(h),f&&n.jsx("div",{className:"move-indicator "+(h?"capture":"")})]},i)}))})}),n.jsxs("div",{className:"player-bar player-bar-bottom",children:[n.jsxs("div",{className:"player-info",children:[n.jsx("div",{className:"player-avatar",children:n.jsx("span",{children:"ðŸ‘¤"})}),n.jsxs("div",{className:"player-details",children:[n.jsx("span",{className:"player-name",children:"You"}),n.jsx("span",{className:"player-rating",children:"w"===y?"White":"Black"})]})]}),n.jsx("div",{className:"captured-pieces",children:B(d,"b")})]})]}),n.jsxs("div",{className:"chess-side-panel right-panel",children:[n.jsx("div",{className:"game-status",children:n.jsx("span",{className:t.isCheck()?"check":"",children:b})}),n.jsxs("div",{className:"move-history",children:[n.jsx("div",{className:"move-history-header",children:"Moves"}),n.jsx("div",{className:"move-history-list",children:(()=>{var t,e;const s=[];for(let n=0;n<h.length;n+=2)s.push({moveNum:Math.floor(n/2)+1,white:(null==(t=h[n])?void 0:t.san)||"",black:(null==(e=h[n+1])?void 0:e.san)||""});return s})().map((t,e)=>n.jsxs("div",{className:"move-row",children:[n.jsxs("span",{className:"move-num",children:[t.moveNum,"."]}),n.jsx("span",{className:"move-white",children:t.white}),n.jsx("span",{className:"move-black",children:t.black})]},e))})]}),n.jsxs("div",{className:"game-controls",children:[n.jsx("button",{onClick:q,className:"control-btn","data-cursor":"disable",children:"New Game"}),n.jsx("button",{onClick:()=>{h.length>0?window.confirm("Start new game?")&&(q(),g(!m)):g(!m)},className:"control-btn","data-cursor":"disable",children:"Flip Board"})]})]})]})]})};export{X as default};
